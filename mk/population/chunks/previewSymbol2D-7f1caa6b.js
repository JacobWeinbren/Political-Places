import{u as e,gG as a,gH as t,c5 as l,gI as n,a as s,gJ as o,gK as i,gL as c,dF as u}from"../main.js";const m="picture-fill",r=120,h=document.createElement("canvas");function p(e,a){const t=h.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}function d(e){if(0===e.length)return 0;if(e.length>2){const a=u(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}function f(u,h){var f,v;const y=null!=(null==h?void 0:h.size)?e(h.size):null,g=null!=(null==h?void 0:h.maxSize)?e(h.maxSize):null,w=null!=(null==h?void 0:h.opacity)?h.opacity:null,M=null!=(null==h?void 0:h.rotation)?h.rotation:"angle"in u?u.angle:null,b=a(u);let x=t(u);if(b&&!x){const e="type"in b?null:new l(b);"#ffffff"===(e?e.toHex():null)&&(x={color:"#bdc3c7",width:.75})}const k={shape:null,fill:null,stroke:x,offset:[0,0]};null!=(f=x)&&f.width&&(x.width=Math.min(x.width,80));const L=(null==(v=x)?void 0:v.width)||0;let z=null!=y&&(null==(null==h?void 0:h.scale)||(null==h?void 0:h.scale)),C=0,F=0,S=!1;switch(u.type){case"simple-marker":{const a=u.style,t=Math.min(null!=y?y:e(u.size),g||r);switch(C=t,F=t,a){case"circle":k.shape={type:"circle",cx:0,cy:0,r:.5*t},z||(C+=L,F+=L);break;case"cross":k.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[C,.5*F]},{command:"M",values:[.5*C,0]},{command:"L",values:[.5*C,F]}]};break;case"diamond":k.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[.5*C,0]},{command:"L",values:[C,.5*F]},{command:"L",values:[.5*C,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L);break;case"square":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,0]},{command:"L",values:[C,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L),M&&(S=!0);break;case"triangle":k.shape={type:"path",path:[{command:"M",values:[.5*C,0]},{command:"L",values:[C,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L),M&&(S=!0);break;case"x":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,F]},{command:"M",values:[C,0]},{command:"L",values:[0,F]}]},M&&(S=!0);break;case"path":k.shape={type:"path",path:u.path||""},z||(C+=L,F+=L),M&&(S=!0),z=!0}break}case"simple-line":{const e=Math.min(null!=y?y:L,g||80),a=e>22?2*e:40;x.width=e,C=a,F=e,k.shape={type:"path",path:[{command:"M",values:[0,F]},{command:"L",values:[C,F]}]};break}case m:case"simple-fill":C=Math.min(null!=y?y:22,g||r)+L,F=C,z=!0,k.shape="object"==typeof(null==h?void 0:h.symbolConfig)&&null!=h&&h.symbolConfig.isSquareFill?n.squareFill[0]:n.fill[0];break;case"picture-marker":{let a=e(u.width),t=e(u.height);const l=Math.max(a,t),n=a/t;a=n<=1?Math.ceil(l*n):l,t=n<=1?l:Math.ceil(l/n),C=Math.min(null!=y?y:a,g||r),F=Math.min(null!=y?y:t,g||r),k.shape={type:"image",x:-Math.round(C/2),y:-Math.round(F/2),width:C,height:F,src:u.url||""},M&&(S=!0);break}case"text":{const a=u,t=a.text||"Aa",l=a.font,n=Math.min(null!=y?y:e(l.size),g||r),s=p(t,{weight:l.weight,size:n,family:l.family}),o=/[\uE600-\uE6FF]/.test(t);C=o?n:s,F=n;let i=.25*d((l?n:0).toString());o&&(i+=5),k.shape={type:"text",text:t,x:0,y:i,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},k.font=l&&{size:n,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!k.shape)return Promise.reject(new s("symbolPreview: renderPreviewHTML2D","symbol not supported."));const j=b,P=u.color;let q=null;return j&&"pattern"===j.type&&P&&u.type!==m?q=o(j.src,P.toCss(!0)).then((e=>(j.src=e,k.fill=j,k))):(k.fill=b,q=Promise.resolve(k)),q.then((e=>{const a=[[e]];if("object"==typeof(null==h?void 0:h.symbolConfig)&&null!=h&&h.symbolConfig.applyColorModulation){const t=.6*C;a.unshift([{...e,offset:[-t,0],fill:i(b,-.3)}]),a.push([{...e,offset:[t,0],fill:i(b,.3)}]),C+=2*t}return c(a,[C,F],{node:h&&h.node,scale:z,opacity:w,rotation:M,useRotationSize:S})}))}export{f as previewSymbol2D};

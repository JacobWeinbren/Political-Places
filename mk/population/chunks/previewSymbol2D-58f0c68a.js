import{u as e,gk as a,gl as t,b$ as l,gm as n,a as s,gn as o,go as i,gp as c,dp as u}from"../main.js";const m="picture-fill",r=120,p=document.createElement("canvas");function h(e,a){const t=p.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}function d(e){if(0===e.length)return 0;if(e.length>2){const a=u(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}function f(u,p){var f,v;const y=null!=(null==p?void 0:p.size)?e(p.size):null,g=null!=(null==p?void 0:p.maxSize)?e(p.maxSize):null,w=null!=(null==p?void 0:p.opacity)?p.opacity:null,b=null!=(null==p?void 0:p.rotation)?p.rotation:"angle"in u?u.angle:null,M=a(u);let k=t(u);if(M&&!k){const e="type"in M?null:new l(M);"#ffffff"===(e?e.toHex():null)&&(k={color:"#bdc3c7",width:.75})}const x={shape:null,fill:null,stroke:k,offset:[0,0]};null!=(f=k)&&f.width&&(k.width=Math.min(k.width,80));const L=(null==(v=k)?void 0:v.width)||0;let z=null!=y&&(null==(null==p?void 0:p.scale)||(null==p?void 0:p.scale)),C=0,F=0,S=!1;switch(u.type){case"simple-marker":{const a=u.style,t=Math.min(null!=y?y:e(u.size),g||r);switch(C=t,F=t,a){case"circle":x.shape={type:"circle",cx:0,cy:0,r:.5*t},z||(C+=L,F+=L);break;case"cross":x.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[C,.5*F]},{command:"M",values:[.5*C,0]},{command:"L",values:[.5*C,F]}]};break;case"diamond":x.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[.5*C,0]},{command:"L",values:[C,.5*F]},{command:"L",values:[.5*C,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L);break;case"square":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,0]},{command:"L",values:[C,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L),b&&(S=!0);break;case"triangle":x.shape={type:"path",path:[{command:"M",values:[.5*C,0]},{command:"L",values:[C,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},z||(C+=L,F+=L),b&&(S=!0);break;case"x":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,F]},{command:"M",values:[C,0]},{command:"L",values:[0,F]}]},b&&(S=!0);break;case"path":x.shape={type:"path",path:u.path||""},z||(C+=L,F+=L),b&&(S=!0),z=!0}break}case"simple-line":{const e=Math.min(null!=y?y:L,g||80),a=e>22?2*e:40;k.width=e,C=a,F=e,x.shape={type:"path",path:[{command:"M",values:[0,F]},{command:"L",values:[C,F]}]};break}case m:case"simple-fill":C=Math.min(null!=y?y:22,g||r)+L,F=C,z=!0,x.shape="object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.isSquareFill?n.squareFill[0]:n.fill[0];break;case"picture-marker":{let a=e(u.width),t=e(u.height);const l=Math.max(a,t),n=a/t;a=n<=1?Math.ceil(l*n):l,t=n<=1?l:Math.ceil(l/n),C=Math.min(null!=y?y:a,g||r),F=Math.min(null!=y?y:t,g||r),x.shape={type:"image",x:-Math.round(C/2),y:-Math.round(F/2),width:C,height:F,src:u.url||""},b&&(S=!0);break}case"text":{const a=u,t=a.text||"Aa",l=a.font,n=Math.min(null!=y?y:e(l.size),g||r),s=h(t,{weight:l.weight,size:n,family:l.family}),o=/[\uE600-\uE6FF]/.test(t);C=o?n:s,F=n;let i=.25*d((l?n:0).toString());o&&(i+=5),x.shape={type:"text",text:t,x:0,y:i,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},x.font=l&&{size:n,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!x.shape)return Promise.reject(new s("symbolPreview: renderPreviewHTML2D","symbol not supported."));const j=M,P=u.color;let q=null;return j&&"pattern"===j.type&&P&&u.type!==m?q=o(j.src,P.toCss(!0)).then((e=>(j.src=e,x.fill=j,x))):(x.fill=M,q=Promise.resolve(x)),q.then((e=>{const a=[[e]];if("object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.applyColorModulation){const t=.6*C;a.unshift([{...e,offset:[-t,0],fill:i(M,-.3)}]),a.push([{...e,offset:[t,0],fill:i(M,.3)}]),C+=2*t}return c(a,[C,F],{node:p&&p.node,scale:z,opacity:w,rotation:b,useRotationSize:S})}))}export{f as previewSymbol2D};

import{t as n,bl as t,bm as s,r as e,bn as r,bo as i,bp as o,bq as u,ap as l,br as a}from"../main.js";import{t as c}from"./json-a3f064db.js";function h(n,t){return n?t?4:3:t?3:2}function m(t,s,e,r,i){if(n(s)||!s.lengths.length)return null;const o="upperLeft"===(null==i?void 0:i.originPosition)?-1:1;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const u=t.coords,l=[],a=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:m}=s,p=h(e,r);let N=0;for(const n of c){const t=f(a,m,N,n,e,r,o);t&&l.push(t),N+=n*p}if(l.sort(((n,t)=>{let s=o*n[2]-o*t[2];return 0===s&&e&&(s=n[4]-t[4]),s})),l.length){let n=6*l[0][2];u[0]=l[0][0]/n,u[1]=l[0][1]/n,e&&(n=6*l[0][4],u[2]=0!==n?l[0][3]/n:0),(u[0]<a[0]||u[0]>a[1]||u[1]<a[2]||u[1]>a[3]||e&&(u[2]<a[4]||u[2]>a[5]))&&(u.length=0)}if(!u.length){const n=s.lengths[0]?I(m,0,c[0],e,r):null;if(!n)return null;u[0]=n[0],u[1]=n[1],e&&n.length>2&&(u[2]=n[2])}return t}function f(n,t,s,e,r,i,o=1){const u=h(r,i);let l=s,a=s+u,c=0,m=0,f=0,I=0,p=0;for(let s=0,i=e-1;s<i;s++,l+=u,a+=u){const s=t[l],e=t[l+1],i=t[l+2],o=t[a],u=t[a+1],h=t[a+2];let N=s*u-o*e;I+=N,c+=(s+o)*N,m+=(e+u)*N,r&&(N=s*h-o*i,f+=(i+h)*N,p+=N),s<n[0]&&(n[0]=s),s>n[1]&&(n[1]=s),e<n[2]&&(n[2]=e),e>n[3]&&(n[3]=e),r&&(i<n[4]&&(n[4]=i),i>n[5]&&(n[5]=i))}if(I*o>0&&(I*=-1),p*o>0&&(p*=-1),!I)return null;const N=[c,m,.5*I];return r&&(N[3]=f,N[4]=.5*p),N}function I(n,t,s,e,r){const i=h(e,r);let o=t,u=t+i,l=0,a=0,c=0,m=0;for(let t=0,r=s-1;t<r;t++,o+=i,u+=i){const t=n[o],s=n[o+1],r=n[o+2],i=n[u],h=n[u+1],f=n[u+2],I=e?N(t,s,r,i,h,f):p(t,s,i,h);if(I)if(l+=I,e){const n=b(t,s,r,i,h,f);a+=I*n[0],c+=I*n[1],m+=I*n[2]}else{const n=g(t,s,i,h);a+=I*n[0],c+=I*n[1]}}return l>0?e?[a/l,c/l,m/l]:[a/l,c/l]:s>0?e?[n[t],n[t+1],n[t+2]]:[n[t],n[t+1]]:null}function p(n,t,s,e){const r=s-n,i=e-t;return Math.sqrt(r*r+i*i)}function N(n,t,s,e,r,i){const o=e-n,u=r-t,l=i-s;return Math.sqrt(o*o+u*u+l*l)}function g(n,t,s,e){return[n+.5*(s-n),t+.5*(e-t)]}function b(n,t,s,e,r,i){return[n+.5*(e-n),t+.5*(r-t),s+.5*(i-s)]}const _=[0,0];function x(n,t){if(!t)return null;if("x"in t){const s={x:0,y:0};return[s.x,s.y]=n(t.x,t.y,_),null!=t.z&&(s.z=t.z),null!=t.m&&(s.m=t.m),s}if("xmin"in t){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=n(t.xmin,t.ymin,_),[s.xmax,s.ymax]=n(t.xmax,t.ymax,_),t.hasZ&&(s.zmin=t.zmin,s.zmax=t.zmax,s.hasZ=!0),t.hasM&&(s.mmin=t.mmin,s.mmax=t.mmax,s.hasM=!0),s}return"rings"in t?{rings:T(t.rings,n),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:T(t.paths,n),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:y(t.points,n),hasM:t.hasM,hasZ:t.hasZ}:void 0}function T(n,t){const s=[];for(const e of n)s.push(y(e,t));return s}function y(n,t){const s=[];for(const e of n){const n=t(e[0],e[1],[0,0]);s.push(n),e.length>2&&n.push(e[2]),e.length>3&&n.push(e[3])}return s}async function E(n,t){if(!t)return;const s=Array.isArray(n)?n.map((n=>e(n.geometry)&&n.geometry.spatialReference)):[n];await r(s.map((n=>({source:n,dest:t}))))}const d=x.bind(null,t),F=x.bind(null,s);function M(n,t,s){if(!n)return n;if(s||(s=t,t=n.spatialReference),!i(t)||!i(s)||o(t,s))return n;if(u(t,s)){const t=l(s)?d(n):F(n);return t.spatialReference=s,t}return a(c,[n],t,s,null)[0]}const V=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,t,s){if(!n||!n.length||!t||!s||o(t,s))return n;const e={geometries:n,inSpatialReference:t,outSpatialReference:s,resolve:null};return this._jobs.push(e),new Promise((n=>{e.resolve=n,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:t,inSpatialReference:s,outSpatialReference:e,resolve:r}=n;u(s,e)?l(e)?r(t.map(d)):r(t.map(F)):r(a(c,t,s,e,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function Y(n,t,s){return V.push(n,t,s)}export{Y as M,m as e,E as f,M as g};

import{b5 as n,b6 as t,aE as s,b7 as e,b8 as r,b9 as i,ba as o,bb as a,am as u,aq as l,ap as c,an as m,ao as h}from"../main.js";import{t as f}from"./json-5b2b387c.js";const p=[0,0];function x(n,t){if(!t)return null;if("x"in t){const s={x:0,y:0};return[s.x,s.y]=n(t.x,t.y,p),null!=t.z&&(s.z=t.z),null!=t.m&&(s.m=t.m),s}if("xmin"in t){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=n(t.xmin,t.ymin,p),[s.xmax,s.ymax]=n(t.xmax,t.ymax,p),t.hasZ&&(s.zmin=t.zmin,s.zmax=t.zmax,s.hasZ=!0),t.hasM&&(s.mmin=t.mmin,s.mmax=t.mmax,s.hasM=!0),s}return"rings"in t?{rings:g(t.rings,n),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:g(t.paths,n),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:y(t.points,n),hasM:t.hasM,hasZ:t.hasZ}:void 0}function g(n,t){const s=[];for(const e of n)s.push(y(e,t));return s}function y(n,t){const s=[];for(const e of n){const n=t(e[0],e[1],[0,0]);s.push(n),e.length>2&&n.push(e[2]),e.length>3&&n.push(e[3])}return s}async function b(n,t){if(!t)return;const s=Array.isArray(n)?n.map((n=>{var t;return null==(t=n.geometry)?void 0:t.spatialReference})):[n];await a(s.map((n=>({source:n,dest:t}))))}const z=x.bind(null,n),_=x.bind(null,t);function M(n,t,a){return n?(a||(a=t,t=n.spatialReference),s(t)&&s(a)&&!e(t,a)?r(t,a)?i(a)?z(n):_(n):o(f,[n],t,a,null)[0]:n):n}const d=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,t,s){if(!n||!n.length||!t||!s||e(t,s))return n;const r={geometries:n,inSpatialReference:t,outSpatialReference:s,resolve:null};return this._jobs.push(r),new Promise((n=>{r.resolve=n,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:t,inSpatialReference:s,outSpatialReference:e,resolve:a}=n;r(s,e)?i(e)?a(t.map(z)):a(t.map(_)):a(o(f,t,s,e,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function Z(n,t,s){return d.push(n,t,s)}const j=(n,t,s)=>[t,s],w=(n,t,s)=>[t,s,n[2]],v=(n,t,s)=>[t,s,n[2],n[3]];function R(n){return n?{originPosition:"upper-left"===n.originPosition?"upperLeft":"lower-left"===n.originPosition?"lowerLeft":n.originPosition,scale:n.tolerance?[n.tolerance,n.tolerance]:[1,1],translate:n.extent?[n.extent.xmin,n.extent.ymax]:[0,0]}:null}function P({scale:n,translate:t},s){return Math.round((s-t[0])/n[0])}function A({scale:n,translate:t},s){return Math.round((t[1]-s)/n[1])}function S(n,t,s){const e=[];let r,i,o,a;for(let u=0;u<s.length;u++){const l=s[u];u>0?(o=P(n,l[0]),a=A(n,l[1]),o===r&&a===i||(e.push(t(l,o-r,a-i)),r=o,i=a)):(r=P(n,l[0]),i=A(n,l[1]),e.push(t(l,r,i)))}return e.length>0?e:null}function L({scale:n,translate:t},s){return s*n[0]+t[0]}function T({scale:n,translate:t},s){return t[1]-s*n[1]}function q(n,t,s){const e=new Array(s.length);if(!s.length)return e;const[r,i]=n.scale;let o=L(n,s[0][0]),a=T(n,s[0][1]);e[0]=t(s[0],o,a);for(let n=1;n<s.length;n++){const u=s[n];o+=u[0]*r,a-=u[1]*i,e[n]=t(u,o,a)}return e}function E(n,t,s){const e=new Array(s.length);for(let r=0;r<s.length;r++)e[r]=q(n,t,s[r]);return e}function k(n,t,s,e,r){return t.points=function(n,t,s,e){return S(n,s?e?v:w:e?w:j,t)}(n,s.points,e,r),t}function B(n,t,s,e,r){return t.x=P(n,s.x),t.y=A(n,s.y),t!==s&&(e&&(t.z=s.z),r&&(t.m=s.m)),t}function C(n,t,s,e,r){const i=function(n,t,s,e){const r=[],i=s?e?v:w:e?w:j;for(let s=0;s<t.length;s++){const e=S(n,i,t[s]);e&&e.length>=3&&r.push(e)}return r.length?r:null}(n,s.rings,e,r);return i?(t.rings=i,t):null}function D(n,t,s,e,r){const i=function(n,t,s,e){const r=[],i=s?e?v:w:e?w:j;for(let s=0;s<t.length;s++){const e=S(n,i,t[s]);e&&e.length>=2&&r.push(e)}return r.length?r:null}(n,s.paths,e,r);return i?(t.paths=i,t):null}function F(n,t){return n&&t?u(t)?B(n,{},t,!1,!1):l(t)?D(n,{},t,!1,!1):c(t)?C(n,{},t,!1,!1):m(t)?k(n,{},t,!1,!1):h(t)?function(n,t,s,e,r){return t.xmin=P(n,s.xmin),t.ymin=A(n,s.ymin),t.xmax=P(n,s.xmax),t.ymax=A(n,s.ymax),t!==s&&(e&&(t.zmin=s.zmin,t.zmax=s.zmax),r&&(t.mmin=s.mmin,t.mmax=s.mmax)),t}(n,{},t,!1,!1):null:null}function G(n,t,s,e,r){return t.points=function(n,t,s,e){return q(n,s?e?v:w:e?w:j,t)}(n,s.points,e,r),t}function H(n,t,s,e,r){return t.x=L(n,s.x),t.y=T(n,s.y),t!==s&&(e&&(t.z=s.z),r&&(t.m=s.m)),t}function I(n,t,s,e,r){return t.rings=function(n,t,s,e){return E(n,s?e?v:w:e?w:j,t)}(n,s.rings,e,r),t}function J(n,t,s,e,r){return t.paths=function(n,t,s,e){return E(n,s?e?v:w:e?w:j,t)}(n,s.paths,e,r),t}export{B as L,G as U,F as d,Z as j,H as k,R as m,b as p,I as q,J as v,M as y};
